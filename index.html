<html>
  <head>
    <meta charset="utf-8" />
    <title>Adventure</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="./aframe-extras.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.5.0/dist/aframe-environment-component.min.js"></script>
    <!-- COMPONENTE DE ANIMACION AL CLIC -->
  <script>
      AFRAME.registerComponent("raycaster-click-emitter", {
        init: function () {
          const controllerEl = this.el;
          controllerEl.addEventListener("triggerdown", function () {
            const intersections = controllerEl.components.raycaster.intersections;
            if (intersections.length > 0) {
              const targetEl = intersections[0].object.el;
              if (targetEl) {
                targetEl.emit("trigger-activated");
              }
            }
          });
        }
      });
    </script>

    <script>
      AFRAME.registerComponent("raycaster-button-a", {
        init: function () {
          const controllerEl = this.el;
          controllerEl.addEventListener("abuttondown", function () {
            const intersections = controllerEl.components.raycaster.intersections;
            if (intersections.length > 0) {
              const targetEl = intersections[0].object.el;
              if (targetEl) {
                targetEl.emit("abutton-activated");
              }
            }
          });
        }
      });
    </script>

    <script>
      AFRAME.registerComponent("raycaster-button-y", {
        init: function () {
          const controllerEl = this.el;
          controllerEl.addEventListener("ybuttondown", function () {
            const intersections = controllerEl.components.raycaster.intersections;
            if (intersections.length > 0) {
              const targetEl = intersections[0].object.el;
              if (targetEl) {
                targetEl.emit("ybutton-activated");
              }
            }
          });
        }
      });
    </script>

    <script>
      AFRAME.registerComponent("triceratops-anim", {
        init: function () {
          const el = this.el;
          const originalClip = "triceratopsLowPolyv11_LODs";
          const triggeredClip = "@IdleBreak";

          el.addEventListener("trigger-activated", function () {

            // Reproduce el sonido
            if (el.components.sound) {
              el.components.sound.playSound();
            }

            // Reproduce la animacion
            el.setAttribute("animation-mixer", {
              clip: triggeredClip,
              loop: "once",
              timeScale: 1
            });

            el.addEventListener("animation-finished", function restore() {
              el.setAttribute("animation-mixer", {
                clip: originalClip,
                loop: "repeat",
                timeScale: 1
              });
              el.removeEventListener("animation-finished", restore);
            });
          });
        }
      });
    </script>

    <script>
      AFRAME.registerComponent("baby-anim", {
        init: function () {
          const el = this.el;
          const originalClip = "Idle";
          const triggeredClip = "LookAround";

          el.addEventListener("trigger-activated", function () {
            el.setAttribute("animation-mixer", {
              clip: triggeredClip,
              loop: "once",
              timeScale: 1
            });

            el.addEventListener("animation-finished", function restore() {
              el.setAttribute("animation-mixer", {
                clip: originalClip,
                loop: "repeat",
                timeScale: 1
              });
              el.removeEventListener("animation-finished", restore);
            });
          });
        }
      });
    </script>

    <script>
      AFRAME.registerComponent("stego-anim", {
        init: function () {
          const el = this.el;
          const originalClip = "Idle";
          const triggeredClip = "Shake"; // Bite, Peak, Crush, Run, Walk,Tail Whip, Angry Idle

          el.addEventListener("trigger-activated", function () {
            el.setAttribute("animation-mixer", {
              clip: triggeredClip,
              loop: "once",
              timeScale: 1
            });

            el.addEventListener("animation-finished", function restore() {
              el.setAttribute("animation-mixer", {
                clip: originalClip,
                loop: "repeat",
                timeScale: 1
              });
              el.removeEventListener("animation-finished", restore);
            });
          });
        }
      });
    </script>

    <script>
      AFRAME.registerComponent("elevate-camera", {
        init: function () {
          const el = this.el;
          el.addEventListener("abutton-activated", () => {
            const rig = document.querySelector("#rig");
            if (rig) {
              const pos = rig.getAttribute("position");
              rig.setAttribute("position", {
                x: pos.x,
                y: pos.y + 15,
                z: pos.z
              });
              console.log("Cámara elevada +15");
            }
          });
        }
      });
    </script>


    <script>
  AFRAME.registerComponent("key-activates-parterre", {
    init: function () {
      const keyEl = this.el;
      keyEl.addEventListener("ybutton-activated", function () {
        const parterre = document.querySelector("#parterre");
        if (parterre) {
          parterre.setAttribute("visible", false);
          console.log("Parterre eliminado al usar la llave.");
        }
      });
    }
  });
</script>



  </head>

  <body>
    <a-scene vr-mode-ui="enabled: true" xrweb="ar: true" environment="preset: forest; ground: none">
      <!-- MODELOS -->
      <a-assets timeout="10000">
        <a-asset-item id="chair-obj" src="./silla.obj"></a-asset-item>
        <a-asset-item id="chair-mtl" src="./Office_chairs.mtl"></a-asset-item>
        <a-asset-item
          id="fuente"
          src="https://cdn.glitch.me/68a66446-b576-4bde-84f6-0b321a80c122/fuente_opt.glb?v=1746381194339"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="deer"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/deer_sculpture.glb?v=1746618133286"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="cosmos"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/garden_flower_-_vegetation.glb?v=1747475281802"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="roses"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/rose_flower.glb?v=1747475774044"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="lavandula"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/flower.glb?v=1747475764735"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="sunflower"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/sunflower.glb?v=1747476953576"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="key"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/poppy_playtime__poppy_key.glb?v=1747476042352"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="triceratops"
          src="https://cdn.aframe.io/examples/ar/models/triceratops/scene.gltf"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="trex"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/looping_animation_of_t-_rex_dinosaur_model.glb?v=1747757483145"
          response-type="arraybuffer"></a-asset-item>
        <!--
        <a-asset-item
          id="diplo"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/diplodocus.glb?v=1747758335978"
          response-type="arraybuffer"></a-asset-item>
          -->
        <a-asset-item
          id="diplo-bebe"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/dinomei.glb?v=1747758232184"
          response-type="arraybuffer"></a-asset-item>
        <a-asset-item
          id="stego"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/overpowered_stegosaurus.glb?v=1748511516291"
          response-type="arraybuffer"></a-asset-item>
        <!--
        <a-asset-item
          id="diplo-space"
          src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/dinomei_space_explorer.glb?v=1747758300074"
          response-type="arraybuffer"></a-asset-item>
          -->

        <img id="sanson" src="sanson.jpeg" />
        <img id="cesped" src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/1601.m10.i311.n029.S.c10.164511620%20Seamless%20green%20grass%20vector%20pattern.jpg?v=1747477475492" />
        <img id="seto" src="https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/view-evergreen-boxwood-shrubs2.jpg?v=1747761539360" />
      </a-assets>

      <a-entity sound="src: url(https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/ambienteAC.mp3?v=1748370245617); autoplay: true; loop: true; volume: 0.5"></a-entity>

      <a-plane src="#cesped" width="100" height="100" rotation="-90 0 0" repeat="50 59" roughness: 10;></a-plane>

      <a-image src="#sanson" width="2" height="1.5" position="0 2 -19"></a-image>

      <!-- Cartel intro -->
      <a-entity position="0 1 -3">
        <!-- Palo -->
        <a-cylinder height="1.5" radius="0.05" color="#5C4033" position="0 -1.25 0"> </a-cylinder>

        <!-- Cartel -->
        <a-box
          width="2"
          height="1"
          depth="0.1"
          material="src: https://cdn.pixabay.com/photo/2017/08/30/07/52/wood-2695450_1280.jpg; roughness: 1; metalness: 0"
          position="0 0 0">
        </a-box>

        <!-- Texto -->
        <a-text value="Bienvenido al laberinto" color="white" align="center" width="1.8" position="0 0 0.06"> </a-text>
      </a-entity>

      <!-- TRICERATOPS ANIMADO -->
      <a-entity
        id="triceratops-obj"
        class="selectable"
        gltf-model="#triceratops"
        animation-mixer="clip: triceratopsLowPolyv11_LODs; loop: repeat; timeScale: 1"
        triceratops-anim
        sound="src: url(https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/rugido.mp3?v=1748370827985); positional: true; volume: 1.0"
        position="2 0 -3"
        scale="0.02 0.02 0.02"
        rotation="0 90 0">
      </a-entity>

      <a-entity
        id="trex-obj"
        class="selectable"
        gltf-model="#trex"
        animation-mixer="clip: Animation; loop: repeat; timeScale: 1.5; crossFadeDuration: 0.2"
        position="-16 0 4"
        scale="0.8 0.8 0.8"
        rotation="0 90 0">
      </a-entity>

      <a-entity
        id="stego-obj"
        class="selectable"
        gltf-model="#stego"
        animation-mixer="clip: Idle; loop: repeat; timeScale: 1.5; crossFadeDuration: 0.2"
        position="-8 0 4"
        scale="3 3 3"
        rotation="0 0 0"
        stego-anim>
      </a-entity>

      <a-entity
        id="key-obj"
        class="selectable"
        gltf-model="#key"
        position="-11 2 -1"
        scale="2 2 2"
        rotation="270 0 0"
                key-activates-parterre>
      </a-entity>

      <!--
      <a-entity
        id="diplo-obj"
        class="selectable"
        gltf-model="#diplo"
        animation-mixer="clip: Animation; loop: repeat; timeScale: 1.5; crossFadeDuration: 0.2"
        position="-4 0 -28"
        scale="3 3 3"
        rotation="0 90 0">
      </a-entity>
      -->

      <a-entity
        id="diplo-bebe-obj"
        class="selectable"
        gltf-model="#diplo-bebe"
        animation-mixer="clip: Idle; loop: repeat; timeScale: 1.5; crossFadeDuration: 0.2"
        baby-anim
        position="23 0 1"
        scale="2 2 2"
        rotation="0 270 0">
      </a-entity>
      <!--
      <a-entity
        id="diplo-space-obj"
        class="selectable"
        gltf-model="#diplo-space"
        animation-mixer="clip: Floating; loop: repeat; timeScale: 1.5; crossFadeDuration: 0.2"
        baby-anim
        position="-4 30 -23"
        scale="1 1 1"
        rotation="0 0 0">
      </a-entity>
      -->

      <a-entity id="deer-obj" class="selectable" gltf-model="#deer" position="2 3 -3" scale="1 1 1" rotation="0 90 0">
      </a-entity>

      <!-- Botón TP -->

<!-- TP -->
      <a-entity position="-2.5 1 -2.5" rotation="270 0 0">
        <!-- Fondo del cartel (madera) -->
        <a-box width="2" height="1" depth="0.1" color="#8B5A2B" material="roughness: 1; metalness: 0"> </a-box>

        <!-- Texto encima del cartel -->
        <a-text
          value="Pulsame :D\n\n(No me deja poner tildes >:[ )"
          color="white"
          align="center"
          width="2"
          position="0 0 0.06">
        </a-text>

        <a-box
        id="elevate-button"
        class="selectable"
        position="0 -0.5 0"
        width="0.5"
        height="0.2"
        depth="0.5"
        color="green"
        elevate-camera>
      </a-box>
      </a-entity>


      <a-entity id="parterre" class="selectable" position="-2.5 -0.2 -3" >
        <!-- Base enorme del parterre -->
          <a-box
            width="8"
            height="0.4"
            depth="4"
            color="#8B5A2B"
            material="src: https://cdn.glitch.global/68a66446-b576-4bde-84f6-0b321a80c122/coast_sand_05_diff_4k.jpg?v=1747762928185;color: #aaffaa; repeat: 4 2; roughness: 0; metalness: 0;"
            position="0 0.2 0"></a-box>

          <!-- Bordes reforzados -->
          <a-box width="8" height="0.3" depth="0.1" color="#5C4033" position="0 0.4 1.95"></a-box>
          <a-box width="8" height="0.3" depth="0.1" color="#5C4033" position="0 0.4 -1.95"></a-box>
          <a-box width="0.1" height="0.3" depth="4" color="#5C4033" position="3.95 0.4 0"></a-box>
          <a-box width="0.1" height="0.3" depth="4" color="#5C4033" position="-3.95 0.4 0"></a-box>

          <!-- Flores Cosmos -->
          <a-entity gltf-model="#cosmos" position="-3 0.4 -1.1" scale="0.3 0.3 0.3" rotation="0 0 0"></a-entity>
          <a-entity gltf-model="#cosmos" position="3 0.4 -1" scale="0.3 0.3 0.3" rotation="0 45 0"></a-entity>
          <a-entity gltf-model="#cosmos" position="0 0.4 1" scale="0.4 0.4 0.4" rotation="0 30 0"></a-entity>

          <!-- Flores Rosas -->
          <a-entity gltf-model="#roses" position="-2.5 0.4 1.5" scale="0.55 0.55 0.55" rotation="0 30 0"></a-entity>
          <a-entity gltf-model="#roses" position="3 0.4 -1" scale="0.5 0.5 0.5" rotation="0 -20 0"></a-entity>
          <a-entity gltf-model="#roses" position="0.5 0.4 -1.5" scale="0.5 0.5 0.5" rotation="0 15 0"></a-entity>
          <a-entity gltf-model="#roses" position="1.6 0.4 0.4" scale="0.5 0.5 0.5" rotation="0 15 0"></a-entity>

          <!-- Flores Lavandula -->
          <a-entity gltf-model="#lavandula" position="-1.5 0.4 0.7" scale="0.7 0.7 0.7" rotation="0 0 0"></a-entity>
          <a-entity gltf-model="#lavandula" position="1.6 0.4 -0.8" scale="0.8 0.8 0.8" rotation="0 90 0"></a-entity>
          <a-entity gltf-model="#lavandula" position="1.8 0.4 1.8" scale="0.7 0.7 0.7" rotation="0 60 0"></a-entity>

          <!-- Flores girasoles -->
          <a-entity gltf-model="#sunflower" position="-0.9 0.4 -1" scale="0.15 0.15 0.15" rotation="0 0 0"></a-entity>
          <a-entity gltf-model="#sunflower" position="1 0.4 -0.8" scale="0.1 0.1 0.1" rotation="0 90 0"></a-entity>
          <a-entity gltf-model="#sunflower" position="1 0.4 -0.8" scale="0.1 0.1 0.1" rotation="0 90 0"></a-entity>
          <a-entity gltf-model="#sunflower" position="2.7 0.4 1" scale="0.12 0.12 0.12" rotation="0 60 0"></a-entity>

        </a-entity>


      <!-- LABERINTO -->
      <a-entity id="maze" position="-20 0 -20">
        <!-- Zona central -->
        <!--<a-box position="15 0.5 15" width="5" height="1" depth="5" color="#FFC65D"></a-box>-->

        <!-- Muros exteriores -->
        <a-box position="17 3 0" width="35" height="6" depth="1" material="src:#seto;color: #ccffcc; repeat: 2 ;"></a-box>
        <a-box position="0 3 18" width="1" height="6" depth="35" material="src:#seto;color: #ccffcc; repeat: 2 ;"></a-box>
        <a-box position="35 3 18" width="1" height="6" depth="35" material="src:#seto;color: #ccffcc; repeat: 2 ;"></a-box>

        <a-box position="7 3 36" width="15" height="6" depth="1" material="src:#seto;color: #ccffcc; repeat: 2 ;"></a-box>
        <a-box position="28 3 36" width="15" height="6" depth="1" material="src:#seto;color: #ccffcc; repeat: 2 ;"></a-box>

        <a-entity
        geometry="primitive: torus;
                  radius: 1.3;
                  radiusTubular: 0.1;
                  arc: 180;
                  segmentsRadial: 36;
                  segmentsTubular: 12"
        material="src:#seto;color: #ccffcc; repeat: 2 ;"
        position="17.5 6 36"
        rotation="0 0 0"
        scale= "2.6 2 2">
      </a-entity>


        <!--Centro-->
        <!--
        <a-box position="17.5 3 17" width="1" height="6" depth="35" color="#4CC3D9"></a-box>
        <a-box position="17.5 3 17" width="1" height="6" depth="35" rotation="0 90 0" color="#4CC3D9"></a-box>
        -->

        <a-entity id="A" position="-12 0 -10">
          <a-box position="0 3 0" width="3" height="6" depth="1" color="#4CC3D9"></a-box>
          <a-box position="-1 3 2" width="1" height="6" depth="5" color="#4CC3D9"></a-box>
          <a-box position="1 3 2" width="1" height="6" depth="5" color="#4CC3D9"></a-box>
          <a-box position="0 3 2" width="3" height="6" depth="1" color="#4CC3D9"></a-box>
        </a-entity>

        <a-entity id="E" position="-18 0 -10">
          <a-box position="0 3 0" width="2" height="6" depth="1" color="#4CC3D9"></a-box>
          <a-box position="0 3 4" width="2" height="6" depth="1" color="#4CC3D9"></a-box>
          <a-box position="-1 3 2" width="1" height="6" depth="3" color="#4CC3D9"></a-box>
          <a-box position="0 3 2" width="2" height="6" depth="1" color="#4CC3D9"></a-box>
        </a-entity>

        <a-entity id="I" position="-5 0 -10">
          <a-box position="0 3 0" width="3" height="6" depth="1" color="#4CC3D9"></a-box>
          <a-box position="0 3 4" width="3" height="6" depth="1" color="#4CC3D9"></a-box>
          <a-box position="0 3 2" width="1" height="6" depth="3" color="#4CC3D9"></a-box>
        </a-entity>

        <a-entity id="Q" position="-7 0 -3">
          <a-box position="11 3 10" width="3" height="6" depth="1" color="#4CC3D9"></a-box>
          <a-box position="11 3 6" width="3" height="6" depth="1" color="#4CC3D9"></a-box>
          <a-box position="10 3 8" width="1" height="6" depth="3" color="#4CC3D9"></a-box>
          <a-box position="12 3 8" width="1" height="6" depth="3" color="#4CC3D9"></a-box>
          <a-box position="13 3 11" width="1" height="6" depth="1" color="#4CC3D9"></a-box>
        </a-entity>
      </a-entity>

      <a-entity id="sky-gallery" position="0 30 0">
  <!-- Suelo del pasillo -->
  <a-box
    position="0 0 0"
    width="10"
    height="0.2"
    depth="4"
    color="#999999"
    material="src: #seto; repeat: 10 1; roughness: 1; metalness: 0">
  </a-box>

  <!-- Pared izquierda -->
  <a-box
    position="-5 2 0"
    width="0.1"
    height="4"
    depth="4"
    color="#ffffff"
    material="src: #sanson; repeat: 1 1; side: double; roughness: 1">
  </a-box>

  <!-- Pared derecha -->
  <a-box
    position="5 2 0"
    width="0.1"
    height="4"
    depth="4"
    color="#ffffff"
    material="src: #sanson; repeat: 1 1; side: double; roughness: 1">
  </a-box>
</a-entity>


      <!-- Camera -->
      <!-- <a-entity id="rig" movement-controls="speed: 0.025" position="-4 30 35"> -->
      <!--<a-entity id="rig" movement-controls="speed: 0.05" position="0 2 0">-->
      <a-entity id="rig" movement-controls="speed: 0.05" position="0 2 0">
        <a-entity camera look-controls wasd-controls position="0 3 0"> </a-entity>
        <!-- CONTROLADORES DE META QUEST -->
        <a-entity
          id="left-controller"
          meta-touch-controls="hand: left"
          raycaster="objects: .selectable; showLine: true"
          line="color: cyan; opacity: 0.6"
          raycaster-button-y
          raycaster-click-emitter>
        </a-entity>

        <a-entity
          id="right-controller"
          meta-touch-controls="hand: right"
          raycaster="objects: .selectable; showLine: true"
          line="color: cyan; opacity: 0.6"
          raycaster-button-a
          raycaster-click-emitter>
        </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
